---
layout:     post
title:      机器人中央控制器框架构思
subtitle:   支持多臂扩展
date:       2019-12-28
author:     BY ZYZ
header-img: img/post-bg-ios9-web.jpg
catalog: true
tags:
    - 中央控制器
    - 代码设计
---

# 背景
## 中央控制器介绍
机器人中央控制器，在机器人控制系统中起着承上启下的作用。在该软件系统中，对上需要对客户端（GUI）发送的指令进行解析，反馈机器人的监控数据；对下，需要把运动信息（如速度，位置，运动模式等）传递给驱动器，并且，采集驱动器的数据信息。

## 当前版本的不足
目前的中央控制器系统，已经能够完成上述的任务，但是，仍然有一些不足。例如：
+ 不能支持多臂扩展
+ 对于末端工具的控制，仅限于在机械臂停止运动的时候，不能在机械臂运动过程中，同时控制工具
+ 状态信息过于繁琐
+ 代码耦合性高，难以维护
  
# 改进思路
## 设计目标
鉴于以上不足，并参考**ROS**的设计理念（~~其实并未参考，只是询问相关专家，了解ROS能够支持哪些功能~~)，对新版中央控制器代码提出了以下几点设计目标：
1. 支持多臂扩展
2. 支持末端工具控制
3. 支持多臂、末端工具同时运动
4. 支持多台机器人扩展
5. 支持定制运动控制算法与轨迹规划算法
6. 代码模块化
   
## HOW
### 几个概念
  我们知道，机器人由关节模组组成，关节中有驱动器，驱动器通过工业总线串联，同样的，末端工具也是通过工业总线接入控制网络中。为此，我们有以下几个概念：
   + 总线（Bus）：这里特指工业总线协议，如EtherCAT、CANOpen等
   + 从站（Slave）：挂在总线上的驱动器或者工具
  
  为了能够支持多臂扩展，以及多台扩展，我们提出以下几个概念：
  + 组（Group）：我们把连在同一根总线上的机器人、工具的集合成为组
  + 工作区（WorkStation)：多个组组成一个工作区
  + 节点（Node）：机器人、工具等称为节点，为了淡化从站概念。
  
### 可能会发生改变的地方
代码设计时，需要考虑将来可能会发生改变的需求。在以往的工程实践中，总结了几点变化的地方。
1. 总线：如果说，机器人系统中，最有可能发生改变的地方，当属总线。可能，今天这个机器人使用的是CANOpen总线，明天就有可能换成EtherCAT总线
2. 轨迹规划算法：这一点也是经常发生改变的。如何平稳有效的规划出合适的运动路径，在机器人运动控制中也是一门学问。
3. 运动控制： 对于不同的运动，有不同的运动控制，走直线与画圆弧就是两种不同的控制方法。
4. 等等

### 代码设计概要   
有了以上的考虑，这一版本的中央控制器代码也不难设计。

+ 首先是总线。这一部分的代码很简单，工厂模式创建总线。
+ 节点：工厂模式。
+ 总线和节点：观察者模式
+ 机器人运动状态：状态模式
+ 工作区包含多个组，而每个组都仅有一个总线，由于总线运行后就处于无限循环状态，必须保证一个线程中**只有一个组**。
+ 与GUI通信： TCP长连接
+ 进程间通信： 消息队列  

值得注意的是，本设计中，让机器人等操作运行在单独的进程中，解耦。